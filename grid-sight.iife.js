var __defProp=Object.defineProperty,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n);this.gridSight=function(){"use strict";function e(e,t={}){const{id:n=`table-${Math.random().toString(36).substr(2,9)}`,applyStyles:o=!0,onComplete:s}=t;e.id||(e.id=n);try{return e.dataset.gridSightProcessed="true",o&&function(e){if(e.classList.add("grid-sight-table"),!document.querySelector("style[data-grid-sight-styles]")){const e=document.createElement("style");e.setAttribute("data-grid-sight-styles","true"),e.textContent="\n      .grid-sight-table {\n        border-collapse: collapse;\n        width: 100%;\n        margin: 1em 0;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      }\n      .grid-sight-table th,\n      .grid-sight-table td {\n        border: 1px solid #ddd;\n        padding: 8px 12px;\n        text-align: left;\n      }\n      .grid-sight-table th {\n        background-color: #f5f5f5;\n        font-weight: 600;\n      }\n      .grid-sight-table tr:nth-child(even) {\n        background-color: #f9f9f9;\n      }\n      .grid-sight-table tr:hover {\n        background-color: #f1f1f1;\n      }\n    ",document.head.appendChild(e)}}(e),function(e){const t=e.querySelectorAll("td, th");t.forEach(((e,t)=>{e.hasAttribute("data-gs-cell-index")||e.setAttribute("data-gs-cell-index",t.toString())}))}(e),"function"==typeof s&&s(e),e}catch(r){throw console.error("Error processing table:",r),r}}const t={minUniqueValuesForCategorical:3,numericThreshold:.8,hasHeader:!0};function n(e){if(null==e)return null;if("number"==typeof e)return isFinite(e)?e:null;const t=e.trim();if(!t)return null;let n=t.replace(/[^\d.,-]/g,"");if(!n)return null;const o=n.startsWith("-");if(o&&(n=n.slice(1)),n.includes("-"))return null;const s=n.split(".");if(s.length>2)return null;if(s[0].includes(",")){const e=s[0].split(",");if(0===e[0].length||e[0].length>3)return null;for(let t=1;t<e.length;t++)if(3!==e[t].length)return null;n=e.join("")+(s[1]?`.${s[1]}`:"")}else if(2===s.length){if(s[1].includes(","))return null;n=s[0]+"."+s[1]}o&&(n="-"+n);const r=parseFloat(n);return isFinite(r)?r:null}function o(e){return null!==n(e)}function s(e,n={}){const{hasHeader:s}={...t,...n},r=(s?e.slice(1):[...e]).map((e=>null==e?void 0:e.trim())).filter((e=>!!e));return 0!==r.length&&r.every((e=>o(e)))}function r(e,n={}){const{minUniqueValuesForCategorical:s,hasHeader:r}={...t,...n},i=(r?e.slice(1):[...e]).map((e=>null==e?void 0:e.trim())).filter((e=>!!e));if(0===i.length)return!1;if(i.some(o))return!1;return new Set(i.map((e=>e.toLowerCase()))).size>=s}function i(e,t={}){if(!e.length)return[];const n=e[0].length,o=[];for(let i=0;i<n;i++){const n=e.map((e=>e[i]||""));s(n,t)?o.push("numeric"):r(n,t)?o.push("categorical"):o.push("unknown")}return o}function l(e){var t,n;if(!e.rows)return[];const o=[];for(let s=0;s<e.rows.length;s++){const r=e.rows[s],i=[];for(let e=0;e<r.cells.length;e++)i.push((null==(n=null==(t=r.cells[e])?void 0:t.textContent)?void 0:n.trim())||"");o.push(i)}return o}const a="gs-heatmap",c=["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f"],d=document.createElement("style");d.textContent="\n  .gs-heatmap-cell {\n    transition: all 0.2s ease;\n    position: relative;\n  }\n  .gs-heatmap-cell:hover {\n    outline: 2px solid #1976d2;\n    outline-offset: -1px;\n    z-index: 1;\n  }\n  .gs-heatmap-split {\n    position: relative;\n    overflow: hidden;\n    color: #000000;\n    font-weight: 500;\n    text-shadow: 0px 0px 2px rgba(255, 255, 255, 0.7);\n    z-index: 1;\n  }\n  .gs-heatmap-split::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(135deg, var(--split-color-1, transparent) 0%, var(--split-color-1, transparent) 50%, var(--split-color-2, transparent) 50%, var(--split-color-2, transparent) 100%);\n    pointer-events: none;\n    z-index: -1;\n  }",document.head.querySelector("style[data-heatmap-styles]")||(d.setAttribute("data-heatmap-styles",""),document.head.appendChild(d));const u=new Set;function h(e,t,n){return`${e.id||e.dataset.gsId||"table"}-${t}-${n}`}function p(e,t,n){const o=h(e,t,n);return u.has(o)}function m(e,t,n,o){const s=h(e,t,n);o?u.add(s):u.delete(s)}function f(e,t,o="column",s={}){if("table"===o)return void y(e,s);if(p(e,t,o))return;const{minValue:r,maxValue:i,colorScale:l=c}=s,d=[],u=[];if("column"===o){const o=!!e.querySelector("tbody")?`tbody tr:not(.gs-header-row) td:nth-child(${t+1})`:`tr:not(.gs-header-row) td:nth-child(${t+1})`;e.querySelectorAll(o).forEach((e=>{const t=n(e.textContent||"");null!==t&&(d.push(e),u.push(t))}))}else{const o=e.querySelector(`tbody tr:nth-child(${t})`);o&&Array.from(o.cells).forEach(((e,t)=>{if(0===t&&e.closest("th"))return;const o=n(e.textContent||"");null!==o&&(d.push(e),u.push(o))}))}if(0===u.length)return void console.warn("No numeric values found for heatmap");const h=void 0!==r?r:Math.min(...u),f=(void 0!==i?i:Math.max(...u))-h,g=[],b=(e,t,n)=>{const o=e.dataset.heatmapType;o&&o!==n?(e.classList.add("gs-heatmap-split"),e.style.setProperty("--split-color-1","row"===o?e.style.backgroundColor||"":t),e.style.setProperty("--split-color-2","column"===o?e.style.backgroundColor||"":t),e.style.backgroundColor=""):(e.style.backgroundColor=t,e.classList.remove("gs-heatmap-split"),e.style.removeProperty("--split-color-1"),e.style.removeProperty("--split-color-2")),e.dataset.heatmapType=n};if(0===f){const e=Math.floor(l.length/2),t=l[e];d.forEach((e=>{b(e,t,o),g.push({element:e,heatmapType:o,style:e.style})}))}else d.forEach(((e,t)=>{const n=(u[t]-h)/f,s=Math.min(l.length-1,Math.max(0,Math.floor(n*l.length)));b(e,l[s],o),g.push({element:e,heatmapType:o,style:e.style})}));e._heatmapInfos||(e._heatmapInfos=[]),m(e,t,o,!0),e.classList.add(a),e._heatmapInfos.push({index:t,type:o,cellElements:g.map((({element:e,heatmapType:t})=>({element:e,heatmapType:t,style:e.style})))}),"test"===process.env.NODE_ENV&&e.offsetHeight;const v=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,index:t,type:o,active:!0}});e.dispatchEvent(v)}function g(e,t){if(e.classList.contains("gs-heatmap-split")){const n="row"===t?"column":"row",o=e.style.getPropertyValue("--split-color-"+("row"===n?"1":"2"));o?e.style.backgroundColor=o:e.style.removeProperty("background-color"),e.classList.remove("gs-heatmap-split"),e.style.removeProperty("--split-color-1"),e.style.removeProperty("--split-color-2")}else e.style.removeProperty("background-color");e.classList.remove("gs-heatmap-cell"),delete e.dataset.heatmapType}function b(e,t,n){if(e._heatmapInfos&&0!==e._heatmapInfos.length)if(void 0!==t&&n){if("table"===n)return void b(e);const o=e._heatmapInfos.findIndex((e=>e.index===t&&e.type===n));if(-1!==o){e._heatmapInfos[o].cellElements.forEach((({element:e,heatmapType:t})=>{g(e,t)})),m(e,t,n,!1),e._heatmapInfos.splice(o,1),0===e._heatmapInfos.length&&e.classList.remove(a);const s=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,index:t,type:n,active:!1}});return void e.dispatchEvent(s)}}else{[...e._heatmapInfos||[]].forEach((t=>{t.cellElements.forEach((({element:e,heatmapType:t})=>{g(e,t)})),m(e,t.index,t.type,!1)})),e._heatmapInfos=[],e.classList.remove(a);const t=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,active:!1}});e.dispatchEvent(t)}}function y(e,t={}){if(p(e,-1,"table"))return;const o=[],s=[],r=Array.from(e.rows);for(let a=1;a<r.length;a++){const e=r[a];Array.from(e.cells).forEach((e=>{var t;if("th"===e.tagName.toLowerCase()||"rowheader"===e.getAttribute("role"))return;const r=n((null==(t=e.textContent)?void 0:t.trim())||"");null!==r&&(o.push(e),s.push(r))}))}if(0===s.length)return void console.warn("No numeric values found for table-wide heatmap");const{minValue:i,maxValue:l,colorScale:d=c}=t,u=void 0!==i?i:Math.min(...s),h=(void 0!==l?l:Math.max(...s))-u,f=[];if(p(e,-1,"table"))return void b(e,-1,"table");if(0===h){const e=Math.floor(d.length/2),t=d[e];o.forEach((e=>{e.style.backgroundColor=t,e.classList.add("gs-heatmap-cell"),e.dataset.heatmapType="table",f.push({element:e,heatmapType:"table",style:e.style})}))}else o.forEach(((e,t)=>{const n=(s[t]-u)/h,o=Math.min(d.length-1,Math.max(0,Math.floor(n*d.length)));e.style.backgroundColor=d[o],e.classList.add("gs-heatmap-cell"),e.dataset.heatmapType="table",f.push({element:e,heatmapType:"table",style:e.style})}));e._heatmapInfos||(e._heatmapInfos=[]),m(e,-1,"table",!0),e.classList.add(a),e._heatmapInfos.push({index:-1,type:"table",cellElements:f}),"test"===process.env.NODE_ENV&&e.offsetHeight;const g=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,index:-1,type:"table",active:!0}});e.dispatchEvent(g)}function v(e,t,n="column",o={}){if("table"===n)return void y(e,o);p(e,t,n)?b(e,t,n):f(e,t,n,o)}const w="gs-enrichment-menu",x=[{id:"heatmap",label:"Heatmap",availableFor:["numeric"]},{id:"statistics",label:"Statistics",availableFor:["numeric"]}];function E(){document.querySelectorAll(`.${w}`).forEach((e=>{e.remove()}))}const C="gs-plus-icon",S="gs-has-plus-icon",L="gs-plus-icon--active";function k(e){e.querySelectorAll(`.${C}`).forEach((e=>e.remove()));e.querySelectorAll(`.${S}`).forEach((e=>e.classList.remove(S)))}function _(e,t){var o;if(e.querySelector(`.${C}`))return;let s="categorical";if("column"===t){const t=e.closest("tr");if(t){const r=Array.from(t.cells).indexOf(e),i=e.closest("table");if(i&&i.rows.length>0){const e=i.rows[1];if(e&&e.cells[r]){const t=(null==(o=e.cells[r].textContent)?void 0:o.trim())||"";s=null!==n(t)?"numeric":"categorical"}}}}else if("row"===t){const t=e.closest("tr");if(t){const e=Array.from(t.cells).slice(1).some((e=>{var t;return null!==n((null==(t=e.textContent)?void 0:t.trim())||"")}));s=e?"numeric":"categorical"}}else if("table"===t){const t=e.closest("table");if(t){const e=Array.from(t.rows).slice(1).some((e=>Array.from(e.cells).some((e=>{var t;return null!==n((null==(t=e.textContent)?void 0:t.trim())||"")}))));s=e?"numeric":"categorical"}}const r=document.createElement("span");r.className=`${C} gs-${t}-plus`,r.textContent="+",r.style.marginLeft="4px",r.style.cursor="pointer",r.addEventListener("click",(n=>{n.stopPropagation(),E();if(r.classList.toggle(L)){const n=function(e,t){const n=document.createElement("div");return n.className=w,n.style.cssText="\n    position: absolute;\n    background: white;\n    border: 1px solid #e0e0e0;\n    border-radius: 4px;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n    z-index: 1000;\n    min-width: 180px;\n    overflow: hidden;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 13px;\n  ",x.filter((t=>t.availableFor.includes(e))).forEach((e=>{const o=document.createElement("div");o.className="gs-enrichment-menu-item",o.style.cssText="\n      display: flex;\n      align-items: center;\n      padding: 8px 12px;\n      cursor: pointer;\n      transition: background-color 0.1s;\n    ",o.innerHTML=`\n      <span class="gs-enrichment-menu-item-label">${e.label}</span>\n    `,o.addEventListener("click",(n=>{n.stopPropagation(),t(e.id)})),o.addEventListener("mouseenter",(()=>{o.style.backgroundColor="#f5f5f5"})),o.addEventListener("mouseleave",(()=>{o.style.backgroundColor=""})),n.appendChild(o)})),n}(s,(o=>{var s,i,l;console.log(`Selected enrichment: ${o} for ${t} header`);const a=new CustomEvent("gridsight:enrichmentSelected",{bubbles:!0,detail:{type:t,enrichmentType:o,header:e,headerIndex:"column"===t?Array.from((null==(s=e.parentElement)?void 0:s.children)||[]).indexOf(e):"row"===t?Array.from((null==(l=null==(i=e.closest("tr"))?void 0:i.parentElement)?void 0:l.children)||[]).indexOf(e.closest("tr")):0}});e.dispatchEvent(a),n.remove(),r.classList.remove(L)}));document.body.appendChild(n),function(e,t){const n=t.getBoundingClientRect(),o=window.innerHeight;let s=n.bottom+window.scrollY,r=n.left+window.scrollX;n.bottom+e.offsetHeight>o&&(s=n.top+window.scrollY-e.offsetHeight),r+e.offsetWidth>window.innerWidth&&(r=window.innerWidth-e.offsetWidth-10),e.style.top=`${Math.max(0,s)}px`,e.style.left=`${Math.max(0,r)}px`}(n,r);const o=e=>{n.contains(e.target)||e.target===r||(n.remove(),r.classList.remove(L),document.removeEventListener("click",o))};setTimeout((()=>{document.addEventListener("click",o)}),0)}})),e.addEventListener("mouseenter",(()=>{r.classList.contains(L)||(r.style.opacity="1")})),e.addEventListener("mouseleave",(()=>{r.classList.contains(L)||(r.style.opacity="0.5")})),e.appendChild(r),e.classList.add(S)}const T=`\n  .${C} {\n    opacity: 0.5;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    border-radius: 3px;\n    background-color: rgba(0, 0, 0, 0.05);\n    margin-left: 4px;\n    font-size: 12px;\n    font-weight: bold;\n    user-select: none;\n  }\n  \n  .${C}:hover {\n    opacity: 1;\n    background-color: rgba(0, 0, 0, 0.1);\n  }\n  \n  .${L} {\n    opacity: 1 !important;\n    background-color: #1976d2;\n    color: white;\n  }\n  \n  .${S} {\n    position: relative;\n    cursor: pointer;\n  }\n  \n  .${S}:hover {\n    background-color: rgba(25, 118, 210, 0.08);\n  }\n`;function M(e){if(0===e.length)return 0;var t,n=e[0],o=0;if("number"!=typeof n)return Number.NaN;for(var s=1;s<e.length;s++){if("number"!=typeof e[s])return Number.NaN;t=n+e[s],Math.abs(n)>=Math.abs(e[s])?o+=n-t+e[s]:o+=e[s]-t+n,n=t}return n+o}function $(e){if(0===e.length)throw new Error("mean requires at least one data point");return M(e)/e.length}function I(e){if(0===e.length)throw new Error("variance requires at least one data point");return function(e){var t,n,o=$(e),s=0;for(n=0;n<e.length;n++)s+=(t=e[n]-o)*t;return s}(e)/e.length}function N(e){if(1===e.length)return 0;var t=I(e);return Math.sqrt(t)}function A(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t}function F(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t}function q(e,t){var n=e.length*t;if(0===e.length)throw new Error("quantile requires at least one data point.");if(t<0||t>1)throw new Error("quantiles must be between 0 and 1");return 1===t?e[e.length-1]:0===t?e[0]:n%1!=0?e[Math.ceil(n)-1]:e.length%2==0?(e[n-1]+e[n])/2:e[n]}function H(e,t,n,o){for(n=n||0,o=o||e.length-1;o>n;){if(o-n>600){var s=o-n+1,r=t-n+1,i=Math.log(s),l=.5*Math.exp(2*i/3),a=.5*Math.sqrt(i*l*(s-l)/s);r-s/2<0&&(a*=-1),H(e,t,Math.max(n,Math.floor(t-r*l/s+a)),Math.min(o,Math.floor(t+(s-r)*l/s+a)))}var c=e[t],d=n,u=o;for(B(e,n,t),e[o]>c&&B(e,n,o);d<u;){for(B(e,d,u),d++,u--;e[d]<c;)d++;for(;e[u]>c;)u--}e[n]===c?B(e,n,u):B(e,++u,o),u<=t&&(n=u+1),t<=u&&(o=u-1)}}function B(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function P(e,t){var n=e.slice();if(Array.isArray(t)){!function(e,t){for(var n=[0],o=0;o<t.length;o++)n.push(V(e.length,t[o]));n.push(e.length-1),n.sort(D);var s=[0,n.length-1];for(;s.length;){var r=Math.ceil(s.pop()),i=Math.floor(s.pop());if(!(r-i<=1)){var l=Math.floor((i+r)/2);z(e,n[l],Math.floor(n[i]),Math.ceil(n[r])),s.push(i,l,l,r)}}}(n,t);for(var o=[],s=0;s<t.length;s++)o[s]=q(n,t[s]);return o}return z(n,V(n.length,t),0,n.length-1),q(n,t)}function z(e,t,n,o){t%1==0?H(e,t,n,o):(H(e,t=Math.floor(t),n,o),H(e,t+1,t+1,o))}function D(e,t){return e-t}function V(e,t){var n=e*t;return 1===t?e-1:0===t?0:n%1!=0?Math.ceil(n)-1:e%2==0?n-.5:n}const O="gs-statistics-popup",j="gs-statistics-popup--visible",U="gs-statistics-popup__header",W="gs-statistics-popup__title",R="gs-statistics-popup__close",Y="gs-statistics-popup__content",G="gs-statistics-popup__stat",K="gs-statistics-popup__stat-label",X="gs-statistics-popup__stat-value",J=`\n.${O} {\n  position: absolute;\n  background: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  z-index: 10000;\n  min-width: 280px;\n  max-width: 320px;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  font-size: 13px;\n  line-height: 1.4;\n  opacity: 0;\n  transform: translateY(-10px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n  pointer-events: none;\n}\n\n.${j} {\n  opacity: 1;\n  transform: translateY(0);\n  pointer-events: auto;\n}\n\n.${U} {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 12px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.${W} {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: #333;\n}\n\n.${R} {\n  background: none;\n  border: none;\n  font-size: 16px;\n  cursor: pointer;\n  color: #999;\n  padding: 2px 6px;\n  border-radius: 3px;\n  line-height: 1;\n}\n\n.${R}:hover {\n  background: #f5f5f5;\n  color: #666;\n}\n\n.${Y} {\n  padding: 12px;\n}\n\n.${G} {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 6px 0;\n  border-bottom: 1px solid #f8f8f8;\n}\n\n.${G}:last-child {\n  border-bottom: none;\n}\n\n.${K} {\n  color: #666;\n  margin-right: 12px;\n}\n\n.${X} {\n  font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;\n  font-size: 12px;\n  color: #333;\n  text-align: right;\n  flex: 1;\n}\n`;class Q{constructor(){__publicField(this,"element"),__publicField(this,"contentElement"),__publicField(this,"closeButton"),__publicField(this,"onCloseCallback",null),__publicField(this,"handleOutsideClick",(e=>{this.element.classList.contains(j)&&!this.element.contains(e.target)&&this.hide()})),__publicField(this,"handleKeyDown",(e=>{"Escape"===e.key&&this.element.classList.contains(j)&&this.hide()})),this.injectStyles(),this.element=document.createElement("div"),this.element.className=O,this.element.setAttribute("role","dialog"),this.element.setAttribute("aria-labelledby","gs-statistics-popup-title");const e=document.createElement("div");e.className=U;const t=document.createElement("h3");t.className=W,t.id="gs-statistics-popup-title",t.textContent="Column Statistics",this.closeButton=document.createElement("button"),this.closeButton.className=R,this.closeButton.innerHTML="&times;",this.closeButton.setAttribute("aria-label","Close"),this.closeButton.addEventListener("click",(()=>this.hide())),e.appendChild(t),e.appendChild(this.closeButton),this.contentElement=document.createElement("div"),this.contentElement.className=Y,this.element.appendChild(e),this.element.appendChild(this.contentElement),document.body.appendChild(this.element),document.addEventListener("click",this.handleOutsideClick),document.addEventListener("keydown",this.handleKeyDown)}injectStyles(){if(document.getElementById("gs-statistics-popup-styles"))return;const e=document.createElement("style");e.id="gs-statistics-popup-styles",e.textContent=J,document.head.appendChild(e)}createStatItem(e,t){const n=document.createElement("div");n.className=G;const o=document.createElement("span");o.className=K,o.textContent=e;const s=document.createElement("span");return s.className=X,s.textContent=String(t),n.appendChild(o),n.appendChild(s),n}formatNumber(e,t=2){return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t}):"N/A"}show(e,t){this.contentElement.innerHTML="",this.contentElement.appendChild(this.createStatItem("Count",e.count.toString())),this.contentElement.appendChild(this.createStatItem("Sum",this.formatNumber(e.sum))),this.contentElement.appendChild(this.createStatItem("Min",this.formatNumber(e.min))),this.contentElement.appendChild(this.createStatItem("Max",this.formatNumber(e.max))),this.contentElement.appendChild(this.createStatItem("Mean",this.formatNumber(e.mean))),this.contentElement.appendChild(this.createStatItem("Median",this.formatNumber(e.median))),this.contentElement.appendChild(this.createStatItem("Std Dev",this.formatNumber(e.stdDev))),this.contentElement.appendChild(this.createStatItem("Variance",this.formatNumber(e.variance))),this.positionPopup(t),this.element.classList.add(j),this.closeButton.focus()}hide(){this.element.classList.remove(j),this.onCloseCallback&&this.onCloseCallback()}positionPopup(e){const t=e.getBoundingClientRect(),n=window.scrollX||document.documentElement.scrollLeft,o=window.scrollY||document.documentElement.scrollTop,s=t.bottom+o+5,r=t.left+n;this.element.style.top=`${s}px`,this.element.style.left=`${r}px`;const i=window.innerWidth,l=this.element.offsetWidth;r+l>i&&(this.element.style.left=i-l-10+"px")}onClose(e){this.onCloseCallback=e}destroy(){document.removeEventListener("click",this.handleOutsideClick),document.removeEventListener("keydown",this.handleKeyDown),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}const Z="grid-sight-toggle",ee="grid-sight-toggle-container",te="grid-sight-toggle--active",ne="grid-sight-enabled",oe=document.createElement("style");oe.textContent=T,document.head.appendChild(oe);function se(e){var t,o;const s=e,{type:r,enrichmentType:i,header:l,headerIndex:a}=s.detail;console.log(`Enrichment selected: ${i} for ${r} header at index ${a}`);const c=l.closest("table");if(c){if(window._gsStatisticsPopup||(window._gsStatisticsPopup=new Q),"heatmap"===i)if("column"===r){const e=l.cellIndex;e>=0&&v(c,e,"column")}else if("row"===r){const e=Array.from((null==(o=null==(t=l.closest("tr"))?void 0:t.parentElement)?void 0:o.children)||[]).indexOf(l.closest("tr"));e>=0&&v(c,e+1,"row")}else"table"===r&&y(c);else if("statistics"===i&&"column"===r){const e=l.cellIndex;if(e>=0)try{const t=function(e,t){var o;const s=[],r=(null==(o=e.tBodies[0])?void 0:o.rows)||[];for(let i=0;i<r.length;i++){const e=r[i].cells[t];if(!e)continue;const o=n(e.textContent||"");null!==o&&s.push(o)}return s}(c,e),o=function(e){if(!e.length)throw new Error("Cannot calculate statistics for an empty array");const t=e.filter(Number.isFinite);if(0===t.length)throw new Error("No valid numeric values provided");return{count:t.length,sum:M(t),min:A(t),max:F(t),mean:$(t),median:(n=t,+P(n,.5)),stdDev:N(t),variance:I(t)};var n}(t);window._gsStatisticsPopup.show(o,l)}catch(d){console.error("Error calculating statistics:",d),alert(`Error: ${d instanceof Error?d.message:"Unknown error"}`)}}if("statistics"!==i){const e=new CustomEvent(`gridsight:enrichment:${i}`,{bubbles:!0,detail:{type:r,header:l,headerIndex:a}});l.dispatchEvent(e)}}}function re(e){var t;const n=(null==(t=e.tHead)?void 0:t.rows[0])||e.rows[0];if(!(null==n?void 0:n.cells.length))return console.warn("Could not find a suitable cell to inject the Grid-Sight toggle"),!1;const o=n.cells[0];if(o.querySelector(`.${Z}, .${ee}`))return!1;try{const t=function(){const e=document.createElement("div");e.className=ee;const t=document.createElement("button");return t.className=Z,t.textContent="GS",t.setAttribute("aria-label","Toggle Grid-Sight"),t.setAttribute("aria-expanded","false"),t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.style.cssText="\n    cursor: pointer;\n    border: 1px solid #ccc;\n    background: #f8f8f8;\n    border-radius: 3px;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-weight: bold;\n    color: #555;\n    margin-right: 8px;\n    vertical-align: middle;\n    transition: all 0.2s ease;\n  ",t.addEventListener("mouseenter",(()=>{t.style.background="#e8e8e8",t.style.borderColor="#999"})),t.addEventListener("mouseleave",(()=>{t.style.background="#f8f8f8",t.style.borderColor="#ccc"})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),e.appendChild(t),e}(),n=t.querySelector(`.${Z}`);return o.insertBefore(t,o.firstChild),n&&n.addEventListener("click",(t=>{t.stopPropagation();const o=n.closest(`.${ee}`),s=n.classList.toggle(te);null==o||o.classList.toggle(te,s),n.setAttribute("aria-expanded",String(s));const r=new CustomEvent("gridsight:toggle",{bubbles:!0,detail:{active:s,target:t.target}});if(n.dispatchEvent(r),s){e.classList.add(ne);const t=Array.from(e.rows).map((e=>Array.from(e.cells).map((e=>e.textContent||"")))),{columnTypes:n}=function(e,t={}){const n=i(e,t),o=n.filter((e=>"numeric"===e||"categorical"===e)).length;return{columnTypes:n,isSuitable:o>=1}}(t);!function(e,t){k(e);const n=e.rows[0];if(n){Array.from(n.cells).forEach(((e,n)=>{const o=0===n,s=t[n];"numeric"!==s&&"categorical"!==s||_(e,o?"table":"column")}));for(let t=1;t<e.rows.length;t++){const n=e.rows[t];n.cells.length&&_(n.cells[0],"row")}}}(e,n),e.addEventListener("gridsight:enrichmentSelected",se)}else e.classList.remove(ne),k(e),E(),e.removeEventListener("gridsight:enrichmentSelected",se)})),e.classList.add("grid-sight-enabled"),!0}catch(s){return console.error("Failed to inject Grid-Sight toggle:",s),!1}}const ie=new Map,le={version:"0.1.0",init(e={}){return document.querySelectorAll("table").forEach(((t,n)=>{if(this.isValidTable(t))try{this.processTable(t,{id:`table-${n}`,...e})}catch(o){console.error(`Failed to process table ${n}:`,o)}else console.warn(`Skipping invalid table at index ${n}: Table must have at least two rows`)})),this},processTable(t,n={}){if(!t)throw new Error("No table element provided");t.id||(t.id=n.id||`grid-sight-${Math.random().toString(36).substr(2,9)}`);const o=e(t,n);ie.set(t.id,t);try{re(t)}catch(s){console.warn("Failed to inject UI elements:",s)}return o},isValidTable(e){if(!(e&&e instanceof HTMLTableElement))return!1;return e.rows.length>=2},getTableById:e=>ie.get(e),getAllTables:()=>Array.from(ie.values()),applyHeatmap(e,t,n="column",o={}){const s="string"==typeof e?this.getTableById(e):e;if(!s)throw new Error("Table not found");f(s,t,n,o)},removeHeatmap(e,t,n){if("string"==typeof e){const o=this.getTableById(e);o&&b(o,t,n)}else b(e,t,n)},toggleHeatmap(e,t,n="column",o={}){const s="string"==typeof e?this.getTableById(e):e;if(!s)throw new Error("Table not found");v(s,t,n,o)},isHeatmapActive(e,t,n="column"){const o="string"==typeof e?this.getTableById(e):e;return!!o&&p(o,t,n)},getColumnType(e,t){const n="string"==typeof e?this.getTableById(e):e;if(!n)throw new Error("Table not found");return i(l(n))[t]||"unknown"},getTableStructure(e){var t;const n="string"==typeof e?this.getTableById(e):e;if(!n)throw new Error("Table not found");const o=l(n);return{rows:o.length,cols:(null==(t=o[0])?void 0:t.length)||0,hasHeader:this.detectIfTableHasHeader(n)}},detectIfTableHasHeader(e){if(e.rows.length<2)return!1;const t=e.rows[0],n=e.rows[1],o=Array.from(t.cells).filter((e=>e.textContent&&""!==e.textContent.trim())).length;if(0===o)return!1;return o>=Array.from(n.cells).filter((e=>e.textContent&&""!==e.textContent.trim())).length}};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{le.init()})):setTimeout((()=>le.init()),0),"undefined"!=typeof window&&(window.gridSight=le),"undefined"!=typeof globalThis&&(globalThis.gridSight=le),"undefined"!=typeof module&&module.exports&&(module.exports=le),le}();
//# sourceMappingURL=grid-sight.iife.js.map
