var __defProp=Object.defineProperty,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__publicField=(e,t,n)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,n);this.gridSight=function(){"use strict";function e(e,t={}){const{id:n=`table-${Math.random().toString(36).substr(2,9)}`,applyStyles:o=!0,onComplete:i}=t;e.id||(e.id=n);try{return e.dataset.gridSightProcessed="true",o&&function(e){if(e.classList.add("grid-sight-table"),!document.querySelector("style[data-grid-sight-styles]")){const e=document.createElement("style");e.setAttribute("data-grid-sight-styles","true"),e.textContent="\n      .grid-sight-table {\n        border-collapse: collapse;\n        width: 100%;\n        margin: 1em 0;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      }\n      .grid-sight-table th,\n      .grid-sight-table td {\n        border: 1px solid #ddd;\n        padding: 8px 12px;\n        text-align: left;\n      }\n      .grid-sight-table th {\n        background-color: #f5f5f5;\n        font-weight: 600;\n      }\n      .grid-sight-table tr:nth-child(even) {\n        background-color: #f9f9f9;\n      }\n      .grid-sight-table tr:hover {\n        background-color: #f1f1f1;\n      }\n    ",document.head.appendChild(e)}}(e),function(e){const t=e.querySelectorAll("td, th");t.forEach(((e,t)=>{e.hasAttribute("data-gs-cell-index")||e.setAttribute("data-gs-cell-index",t.toString())}))}(e),"function"==typeof i&&i(e),e}catch(s){throw console.error("Error processing table:",s),s}}const t={minUniqueValuesForCategorical:3,numericThreshold:.8,hasHeader:!0};function n(e){if(null==e)return null;if("number"==typeof e)return isFinite(e)?e:null;const t=e.trim();if(!t)return null;let n=t.replace(/[^\d.,-]/g,"");if(!n)return null;const o=n.startsWith("-");if(o&&(n=n.slice(1)),n.includes("-"))return null;const i=n.split(".");if(i.length>2)return null;if(i[0].includes(",")){const e=i[0].split(",");if(0===e[0].length||e[0].length>3)return null;for(let t=1;t<e.length;t++)if(3!==e[t].length)return null;n=e.join("")+(i[1]?`.${i[1]}`:"")}else if(2===i.length){if(i[1].includes(","))return null;n=i[0]+"."+i[1]}o&&(n="-"+n);const s=parseFloat(n);return isFinite(s)?s:null}function o(e){return null!==n(e)}function i(e,n={}){const{hasHeader:i}={...t,...n},s=(i?e.slice(1):[...e]).map((e=>null==e?void 0:e.trim())).filter((e=>!!e));return 0!==s.length&&s.every((e=>o(e)))}function s(e,n={}){const{minUniqueValuesForCategorical:i,hasHeader:s}={...t,...n},r=(s?e.slice(1):[...e]).map((e=>null==e?void 0:e.trim())).filter((e=>!!e));if(0===r.length)return!1;if(r.some(o))return!1;return new Set(r.map((e=>e.toLowerCase()))).size>=i}function r(e,t={}){if(!e.length)return[];const n=e[0].length,o=[];for(let r=0;r<n;r++){const n=e.map((e=>e[r]||""));i(n,t)?o.push("numeric"):s(n,t)?o.push("categorical"):o.push("unknown")}return o}function l(e){var t,n;if(!e.rows)return[];const o=[];for(let i=0;i<e.rows.length;i++){const s=e.rows[i],r=[];for(let e=0;e<s.cells.length;e++)r.push((null==(n=null==(t=s.cells[e])?void 0:t.textContent)?void 0:n.trim())||"");o.push(r)}return o}const a="gs-heatmap",c=["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f"],d=document.createElement("style");d.textContent="\n  .gs-heatmap-cell {\n    transition: all 0.2s ease;\n    position: relative;\n  }\n  .gs-heatmap-cell:hover {\n    outline: 2px solid #1976d2;\n    outline-offset: -1px;\n    z-index: 1;\n  }\n  .gs-heatmap-split {\n    position: relative;\n    overflow: hidden;\n    color: #000000;\n    font-weight: 500;\n    text-shadow: 0px 0px 2px rgba(255, 255, 255, 0.7);\n    z-index: 1;\n  }\n  .gs-heatmap-split::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(135deg, var(--split-color-1, transparent) 0%, var(--split-color-1, transparent) 50%, var(--split-color-2, transparent) 50%, var(--split-color-2, transparent) 100%);\n    pointer-events: none;\n    z-index: -1;\n  }",document.head.querySelector("style[data-heatmap-styles]")||(d.setAttribute("data-heatmap-styles",""),document.head.appendChild(d));const h=new Set;function u(e,t,n){return`${e.id||e.dataset.gsId||"table"}-${t}-${n}`}function m(e,t,n){const o=u(e,t,n);return h.has(o)}function p(e,t,n,o){const i=u(e,t,n);o?h.add(i):h.delete(i)}function g(e,t,o="column",i={}){if("table"===o)return void y(e,i);if(m(e,t,o))return;const{minValue:s,maxValue:r,colorScale:l=c}=i,d=[],h=[];if("column"===o){const o=!!e.querySelector("tbody")?`tbody tr:not(.gs-header-row) td:nth-child(${t+1})`:`tr:not(.gs-header-row) td:nth-child(${t+1})`;e.querySelectorAll(o).forEach((e=>{const t=n(e.textContent||"");null!==t&&(d.push(e),h.push(t))}))}else{const o=e.querySelector(`tbody tr:nth-child(${t})`);o&&Array.from(o.cells).forEach(((e,t)=>{if(0===t&&e.closest("th"))return;const o=n(e.textContent||"");null!==o&&(d.push(e),h.push(o))}))}if(0===h.length)return void console.warn("No numeric values found for heatmap");const u=void 0!==s?s:Math.min(...h),g=(void 0!==r?r:Math.max(...h))-u,f=[],b=(e,t,n)=>{const o=e.dataset.heatmapType;o&&o!==n?(e.classList.add("gs-heatmap-split"),e.style.setProperty("--split-color-1","row"===o?e.style.backgroundColor||"":t),e.style.setProperty("--split-color-2","column"===o?e.style.backgroundColor||"":t),e.style.backgroundColor=""):(e.style.backgroundColor=t,e.classList.remove("gs-heatmap-split"),e.style.removeProperty("--split-color-1"),e.style.removeProperty("--split-color-2")),e.dataset.heatmapType=n};if(0===g){const e=Math.floor(l.length/2),t=l[e];d.forEach((e=>{b(e,t,o),f.push({element:e,heatmapType:o,style:e.style})}))}else d.forEach(((e,t)=>{const n=(h[t]-u)/g,i=Math.min(l.length-1,Math.max(0,Math.floor(n*l.length)));b(e,l[i],o),f.push({element:e,heatmapType:o,style:e.style})}));e._heatmapInfos||(e._heatmapInfos=[]),p(e,t,o,!0),e.classList.add(a),e._heatmapInfos.push({index:t,type:o,cellElements:f.map((({element:e,heatmapType:t})=>({element:e,heatmapType:t,style:e.style})))}),"test"===process.env.NODE_ENV&&e.offsetHeight;const w=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,index:t,type:o,active:!0}});e.dispatchEvent(w)}function f(e,t){if(e.classList.contains("gs-heatmap-split")){const n="row"===t?"column":"row",o=e.style.getPropertyValue("--split-color-"+("row"===n?"1":"2"));o?e.style.backgroundColor=o:e.style.removeProperty("background-color"),e.classList.remove("gs-heatmap-split"),e.style.removeProperty("--split-color-1"),e.style.removeProperty("--split-color-2")}else e.style.removeProperty("background-color");e.classList.remove("gs-heatmap-cell"),delete e.dataset.heatmapType}function b(e,t,n){if(e._heatmapInfos&&0!==e._heatmapInfos.length)if(void 0!==t&&n){if("table"===n)return void b(e);const o=e._heatmapInfos.findIndex((e=>e.index===t&&e.type===n));if(-1!==o){e._heatmapInfos[o].cellElements.forEach((({element:e,heatmapType:t})=>{f(e,t)})),p(e,t,n,!1),e._heatmapInfos.splice(o,1),0===e._heatmapInfos.length&&e.classList.remove(a);const i=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,index:t,type:n,active:!1}});return void e.dispatchEvent(i)}}else{[...e._heatmapInfos||[]].forEach((t=>{t.cellElements.forEach((({element:e,heatmapType:t})=>{f(e,t)})),p(e,t.index,t.type,!1)})),e._heatmapInfos=[],e.classList.remove(a);const t=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,active:!1}});e.dispatchEvent(t)}}function y(e,t={}){if(m(e,-1,"table"))return;const o=[],i=[],s=Array.from(e.rows);for(let a=1;a<s.length;a++){const e=s[a];Array.from(e.cells).forEach((e=>{var t;if("th"===e.tagName.toLowerCase()||"rowheader"===e.getAttribute("role"))return;const s=n((null==(t=e.textContent)?void 0:t.trim())||"");null!==s&&(o.push(e),i.push(s))}))}if(0===i.length)return void console.warn("No numeric values found for table-wide heatmap");const{minValue:r,maxValue:l,colorScale:d=c}=t,h=void 0!==r?r:Math.min(...i),u=(void 0!==l?l:Math.max(...i))-h,g=[];if(m(e,-1,"table"))return void b(e,-1,"table");if(0===u){const e=Math.floor(d.length/2),t=d[e];o.forEach((e=>{e.style.backgroundColor=t,e.classList.add("gs-heatmap-cell"),e.dataset.heatmapType="table",g.push({element:e,heatmapType:"table",style:e.style})}))}else o.forEach(((e,t)=>{const n=(i[t]-h)/u,o=Math.min(d.length-1,Math.max(0,Math.floor(n*d.length)));e.style.backgroundColor=d[o],e.classList.add("gs-heatmap-cell"),e.dataset.heatmapType="table",g.push({element:e,heatmapType:"table",style:e.style})}));e._heatmapInfos||(e._heatmapInfos=[]),p(e,-1,"table",!0),e.classList.add(a),e._heatmapInfos.push({index:-1,type:"table",cellElements:g}),"test"===process.env.NODE_ENV&&e.offsetHeight;const f=new CustomEvent("gridsight:heatmapChanged",{bubbles:!0,detail:{table:e,index:-1,type:"table",active:!0}});e.dispatchEvent(f)}function w(e,t,n="column",o={}){const i="table"===n?-1:t;m(e,i,n)?b(e,i,n):"table"===n?y(e,o):g(e,t,n,o)}const v="gs-enrichment-menu",x=[{id:"heatmap",label:"Heatmap",availableFor:["numeric"]},{id:"statistics",label:"Statistics",availableFor:["numeric"]},{id:"frequency",label:"Frequency (table)",availableFor:["categorical"]},{id:"frequency-chart",label:"Frequency (chart)",availableFor:["categorical"]}];function C(){document.querySelectorAll(`.${v}`).forEach((e=>{e.remove()}))}const E="gs-plus-icon",k="gs-has-plus-icon",_="gs-plus-icon--active";function S(e){e.querySelectorAll(`.${E}`).forEach((e=>e.remove()));e.querySelectorAll(`.${k}`).forEach((e=>e.classList.remove(k)))}function $(e,t){var o;if(e.querySelector(`.${E}`))return;let i="categorical";if("column"===t){const t=e.closest("tr");if(t){const s=Array.from(t.cells).indexOf(e),r=e.closest("table");if(r&&r.rows.length>0){const e=r.rows[1];if(e&&e.cells[s]){const t=(null==(o=e.cells[s].textContent)?void 0:o.trim())||"";i=null!==n(t)?"numeric":"categorical"}}}}else if("row"===t){const t=e.closest("tr");if(t){const e=Array.from(t.cells).slice(1).some((e=>{var t;return null!==n((null==(t=e.textContent)?void 0:t.trim())||"")}));i=e?"numeric":"categorical"}}else if("table"===t){const t=e.closest("table");if(t){const e=Array.from(t.rows).slice(1).some((e=>Array.from(e.cells).some((e=>{var t;return null!==n((null==(t=e.textContent)?void 0:t.trim())||"")}))));i=e?"numeric":"categorical"}}const s=document.createElement("span");s.className=`${E} gs-${t}-plus`,s.textContent="+",s.style.marginLeft="4px",s.style.cursor="pointer",s.addEventListener("click",(n=>{n.stopPropagation(),C();if(s.classList.toggle(_)){const n=function(e,t){const n=document.createElement("div");return n.className=v,n.style.cssText="\n    position: absolute;\n    background: white;\n    border: 1px solid #e0e0e0;\n    border-radius: 4px;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n    z-index: 1000;\n    min-width: 180px;\n    overflow: hidden;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 13px;\n  ",x.filter((t=>t.availableFor.includes(e))).forEach((e=>{const o=document.createElement("div");o.className="gs-enrichment-menu-item",o.style.cssText="\n      display: flex;\n      align-items: center;\n      padding: 8px 12px;\n      cursor: pointer;\n      transition: background-color 0.1s;\n    ",o.innerHTML=`\n      <span class="gs-enrichment-menu-item-label">${e.label}</span>\n    `,o.addEventListener("click",(n=>{n.stopPropagation(),t(e.id)})),o.addEventListener("mouseenter",(()=>{o.style.backgroundColor="#f5f5f5"})),o.addEventListener("mouseleave",(()=>{o.style.backgroundColor=""})),n.appendChild(o)})),n}(i,(o=>{var i,r,l;console.log(`Selected enrichment: ${o} for ${t} header`);const a=new CustomEvent("gridsight:enrichmentSelected",{bubbles:!0,detail:{type:t,enrichmentType:o,header:e,headerIndex:"column"===t?Array.from((null==(i=e.parentElement)?void 0:i.children)||[]).indexOf(e):"row"===t?Array.from((null==(l=null==(r=e.closest("tr"))?void 0:r.parentElement)?void 0:l.children)||[]).indexOf(e.closest("tr")):0}});e.dispatchEvent(a),n.remove(),s.classList.remove(_)}));document.body.appendChild(n),function(e,t){const n=t.getBoundingClientRect(),o=window.innerHeight;let i=n.bottom+window.scrollY,s=n.left+window.scrollX;n.bottom+e.offsetHeight>o&&(i=n.top+window.scrollY-e.offsetHeight),s+e.offsetWidth>window.innerWidth&&(s=window.innerWidth-e.offsetWidth-10),e.style.top=`${Math.max(0,i)}px`,e.style.left=`${Math.max(0,s)}px`}(n,s);const o=e=>{n.contains(e.target)||e.target===s||(n.remove(),s.classList.remove(_),document.removeEventListener("click",o))};setTimeout((()=>{document.addEventListener("click",o)}),0)}})),e.addEventListener("mouseenter",(()=>{s.classList.contains(_)||(s.style.opacity="1")})),e.addEventListener("mouseleave",(()=>{s.classList.contains(_)||(s.style.opacity="0.5")})),e.appendChild(s),e.classList.add(k)}const A=`\n  .${E} {\n    opacity: 0.5;\n    transition: all 0.2s ease;\n    cursor: pointer;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    width: 16px;\n    height: 16px;\n    border-radius: 3px;\n    background-color: rgba(0, 0, 0, 0.05);\n    margin-left: 4px;\n    font-size: 12px;\n    font-weight: bold;\n    user-select: none;\n  }\n  \n  .${E}:hover {\n    opacity: 1;\n    background-color: rgba(0, 0, 0, 0.1);\n  }\n  \n  .${_} {\n    opacity: 1 !important;\n    background-color: #1976d2;\n    color: white;\n  }\n  \n  .${k} {\n    position: relative;\n    cursor: pointer;\n  }\n  \n  .${k}:hover {\n    background-color: rgba(25, 118, 210, 0.08);\n  }\n`;function L(e){if(0===e.length)return 0;var t,n=e[0],o=0;if("number"!=typeof n)return Number.NaN;for(var i=1;i<e.length;i++){if("number"!=typeof e[i])return Number.NaN;t=n+e[i],Math.abs(n)>=Math.abs(e[i])?o+=n-t+e[i]:o+=e[i]-t+n,n=t}return n+o}function N(e){if(0===e.length)throw new Error("mean requires at least one data point");return L(e)/e.length}function q(e){if(0===e.length)throw new Error("variance requires at least one data point");return function(e){var t,n,o=N(e),i=0;for(n=0;n<e.length;n++)i+=(t=e[n]-o)*t;return i}(e)/e.length}function B(e){if(1===e.length)return 0;var t=q(e);return Math.sqrt(t)}function M(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t}function F(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t}function T(e,t){var n=e.length*t;if(0===e.length)throw new Error("quantile requires at least one data point.");if(t<0||t>1)throw new Error("quantiles must be between 0 and 1");return 1===t?e[e.length-1]:0===t?e[0]:n%1!=0?e[Math.ceil(n)-1]:e.length%2==0?(e[n-1]+e[n])/2:e[n]}function I(e,t,n,o){for(n=n||0,o=o||e.length-1;o>n;){if(o-n>600){var i=o-n+1,s=t-n+1,r=Math.log(i),l=.5*Math.exp(2*r/3),a=.5*Math.sqrt(r*l*(i-l)/i);s-i/2<0&&(a*=-1),I(e,t,Math.max(n,Math.floor(t-s*l/i+a)),Math.min(o,Math.floor(t+(i-s)*l/i+a)))}var c=e[t],d=n,h=o;for(D(e,n,t),e[o]>c&&D(e,n,o);d<h;){for(D(e,d,h),d++,h--;e[d]<c;)d++;for(;e[h]>c;)h--}e[n]===c?D(e,n,h):D(e,++h,o),h<=t&&(n=h+1),t<=h&&(o=h-1)}}function D(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function H(e,t){var n=e.slice();if(Array.isArray(t)){!function(e,t){for(var n=[0],o=0;o<t.length;o++)n.push(z(e.length,t[o]));n.push(e.length-1),n.sort(P);var i=[0,n.length-1];for(;i.length;){var s=Math.ceil(i.pop()),r=Math.floor(i.pop());if(!(s-r<=1)){var l=Math.floor((r+s)/2);O(e,n[l],Math.floor(n[r]),Math.ceil(n[s])),i.push(r,l,l,s)}}}(n,t);for(var o=[],i=0;i<t.length;i++)o[i]=T(n,t[i]);return o}return O(n,z(n.length,t),0,n.length-1),T(n,t)}function O(e,t,n,o){t%1==0?I(e,t,n,o):(I(e,t=Math.floor(t),n,o),I(e,t+1,t+1,o))}function P(e,t){return e-t}function z(e,t){var n=e*t;return 1===t?e-1:0===t?0:n%1!=0?Math.ceil(n)-1:e%2==0?n-.5:n}function j(e){if(!e.length)throw new Error("Cannot calculate statistics for an empty array");const t=e.filter(Number.isFinite);if(0===t.length)throw new Error("No valid numeric values provided");return{count:t.length,sum:L(t),min:M(t),max:F(t),mean:N(t),median:(n=t,+H(n,.5)),stdDev:B(t),variance:q(t)};var n}function K(e){const t=String(e??"").trim();return""===t?"[Empty]":t.toLowerCase()}function V(e){const t=e.length;if(0===t)return[];const n=function(e){const t={};for(const n of e){const e=K(n);t[e]=(t[e]||0)+1}return t}(e),o=function(e){return Object.entries(e).sort((([e],[t])=>e.localeCompare(t)))}(n);return o.map((([e,n])=>[e,n,Number((n/t*100).toFixed(1))]))}const R="gs-statistics-popup",U="gs-statistics-popup--visible",Y="gs-statistics-popup__header",W="gs-statistics-popup__title",G="gs-statistics-popup__close",X="gs-statistics-popup__content",J="gs-statistics-popup__stat",Q="gs-statistics-popup__stat-label",Z="gs-statistics-popup__stat-value",ee=`\n.${R} {\n  position: absolute;\n  background: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  z-index: 10000;\n  min-width: 280px;\n  max-width: 320px;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  font-size: 13px;\n  line-height: 1.4;\n  opacity: 0;\n  transform: translateY(-10px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n  pointer-events: none;\n}\n\n.${U} {\n  opacity: 1;\n  transform: translateY(0);\n  pointer-events: auto;\n}\n\n.${Y} {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 12px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.${W} {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: #333;\n}\n\n.${G} {\n  background: none;\n  border: none;\n  font-size: 16px;\n  cursor: pointer;\n  color: #999;\n  padding: 2px 6px;\n  border-radius: 3px;\n  line-height: 1;\n}\n\n.${G}:hover {\n  background: #f5f5f5;\n  color: #666;\n}\n\n.${X} {\n  padding: 12px;\n}\n\n.${J} {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 6px 0;\n  border-bottom: 1px solid #f8f8f8;\n}\n\n.${J}:last-child {\n  border-bottom: none;\n}\n\n.${Q} {\n  color: #666;\n  margin-right: 12px;\n}\n\n.${Z} {\n  font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;\n  font-size: 12px;\n  color: #333;\n  text-align: right;\n  flex: 1;\n}\n`;class te{constructor(){__publicField(this,"element"),__publicField(this,"contentElement"),__publicField(this,"closeButton"),__publicField(this,"onCloseCallback",null),__publicField(this,"handleOutsideClick",(e=>{this.element.classList.contains(U)&&!this.element.contains(e.target)&&this.hide()})),__publicField(this,"handleKeyDown",(e=>{"Escape"===e.key&&this.element.classList.contains(U)&&this.hide()})),this.injectStyles(),this.element=document.createElement("div"),this.element.className=R,this.element.setAttribute("role","dialog"),this.element.setAttribute("aria-labelledby","gs-statistics-popup-title");const e=document.createElement("div");e.className=Y;const t=document.createElement("h3");t.className=W,t.id="gs-statistics-popup-title",t.textContent="Column Statistics",this.closeButton=document.createElement("button"),this.closeButton.className=G,this.closeButton.innerHTML="&times;",this.closeButton.setAttribute("aria-label","Close"),this.closeButton.addEventListener("click",(()=>this.hide())),e.appendChild(t),e.appendChild(this.closeButton),this.contentElement=document.createElement("div"),this.contentElement.className=X,this.element.appendChild(e),this.element.appendChild(this.contentElement),document.body.appendChild(this.element),document.addEventListener("click",this.handleOutsideClick),document.addEventListener("keydown",this.handleKeyDown)}injectStyles(){if(document.getElementById("gs-statistics-popup-styles"))return;const e=document.createElement("style");e.id="gs-statistics-popup-styles",e.textContent=ee,document.head.appendChild(e)}createStatItem(e,t){const n=document.createElement("div");n.className=J;const o=document.createElement("span");o.className=Q,o.textContent=e;const i=document.createElement("span");return i.className=Z,i.textContent=String(t),n.appendChild(o),n.appendChild(i),n}formatNumber(e,t=2){return Number.isFinite(e)?e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t}):"N/A"}show(e,t){this.contentElement.innerHTML="",this.contentElement.appendChild(this.createStatItem("Count",e.count.toString())),this.contentElement.appendChild(this.createStatItem("Sum",this.formatNumber(e.sum))),this.contentElement.appendChild(this.createStatItem("Min",this.formatNumber(e.min))),this.contentElement.appendChild(this.createStatItem("Max",this.formatNumber(e.max))),this.contentElement.appendChild(this.createStatItem("Mean",this.formatNumber(e.mean))),this.contentElement.appendChild(this.createStatItem("Median",this.formatNumber(e.median))),this.contentElement.appendChild(this.createStatItem("Std Dev",this.formatNumber(e.stdDev))),this.contentElement.appendChild(this.createStatItem("Variance",this.formatNumber(e.variance))),this.positionPopup(t),this.element.classList.add(U),this.closeButton.focus()}hide(){this.element.classList.remove(U),this.onCloseCallback&&this.onCloseCallback()}positionPopup(e){const t=e.getBoundingClientRect(),n=window.scrollX||document.documentElement.scrollLeft,o=window.scrollY||document.documentElement.scrollTop,i=t.bottom+o+5,s=t.left+n;this.element.style.top=`${i}px`,this.element.style.left=`${s}px`;const r=window.innerWidth,l=this.element.offsetWidth;s+l>r&&(this.element.style.left=r-l-10+"px")}onClose(e){this.onCloseCallback=e}destroy(){document.removeEventListener("click",this.handleOutsideClick),document.removeEventListener("keydown",this.handleKeyDown),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}const ne="gs-frequency-dialog",oe="gs-frequency-dialog--visible",ie="gs-frequency-dialog__header",se="gs-frequency-dialog__title",re="gs-frequency-dialog__close",le="gs-frequency-dialog__content",ae="gs-frequency-dialog__table",ce="gs-frequency-dialog__table-head",de="gs-frequency-dialog__table-body",he=`\n.${ne} {\n  position: absolute;\n  background: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  z-index: 10000;\n  min-width: 300px;\n  max-width: 500px;\n  max-height: 60vh;\n  display: flex;\n  flex-direction: column;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  font-size: 13px;\n  line-height: 1.4;\n  opacity: 0;\n  transform: translateY(-10px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n  pointer-events: none;\n}\n\n.${oe} {\n  opacity: 1;\n  transform: translateY(0);\n  pointer-events: auto;\n}\n\n.${ie} {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 12px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.${se} {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: #333;\n}\n\n.${re} {\n  background: none;\n  border: none;\n  font-size: 16px;\n  cursor: pointer;\n  color: #999;\n  padding: 2px 6px;\n  border-radius: 3px;\n  line-height: 1;\n}\n\n.${re}:hover {\n  background: #f5f5f5;\n  color: #666;\n}\n\n.${le} {\n  padding: 0;\n  overflow-y: auto;\n}\n\n.${ae} {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 13px;\n}\n\n.${ce} {\n  position: sticky;\n  top: 0;\n  background-color: #f8f9fa;\n  font-weight: 600;\n  color: #495057;\n  border-bottom: 2px solid #e9ecef;\n}\n\n.${ce} th {\n  padding: 10px 12px;\n  text-align: left;\n}\n\n.${de} tr:not(:last-child) {\n  border-bottom: 1px solid #e9ecef;\n}\n\n.${de} td {\n  padding: 8px 12px;\n  vertical-align: middle;\n}\n\n.${de} tr:hover {\n  background-color: #f8f9fa;\n}\n\n/* Scrollbar styling */\n.${le}::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n.${le}::-webkit-scrollbar-thumb {\n  background-color: #c1c1c1;\n  border-radius: 3px;\n}\n\n.${le}::-webkit-scrollbar-thumb:hover {\n  background-color: #a8a8a8;\n}\n\n.${le}::-webkit-scrollbar-track {\n  background-color: #f1f1f1;\n  border-radius: 3px;\n}\n`;class ue{constructor(){__publicField(this,"element"),__publicField(this,"contentElement"),__publicField(this,"tableBody"),__publicField(this,"closeButton"),__publicField(this,"onCloseCallback",null),__publicField(this,"handleOutsideClickBound"),__publicField(this,"handleKeyDownBound"),this.injectStyles(),this.element=document.createElement("div"),this.element.className=ne,this.element.setAttribute("role","dialog"),this.element.setAttribute("aria-labelledby","gs-frequency-dialog-title");const e=document.createElement("div");e.className=ie;const t=document.createElement("h3");t.className=se,t.id="gs-frequency-dialog-title",t.textContent="Frequency Analysis",this.closeButton=document.createElement("button"),this.closeButton.className=re,this.closeButton.innerHTML="&times;",this.closeButton.setAttribute("aria-label","Close"),this.closeButton.addEventListener("click",(()=>this.hide())),e.appendChild(t),e.appendChild(this.closeButton),this.contentElement=document.createElement("div"),this.contentElement.className=le;const n=document.createElement("table");n.className=ae;const o=document.createElement("thead");o.className=ce;const i=document.createElement("tr");["Value","Count","Percentage"].forEach((e=>{const t=document.createElement("th");t.textContent=e,i.appendChild(t)})),o.appendChild(i),this.tableBody=document.createElement("tbody"),this.tableBody.className=de,n.appendChild(o),n.appendChild(this.tableBody),this.contentElement.appendChild(n),this.element.appendChild(e),this.element.appendChild(this.contentElement),document.body.appendChild(this.element),this.handleOutsideClickBound=this.handleOutsideClick.bind(this),this.handleKeyDownBound=this.handleKeyDown.bind(this)}injectStyles(){if(document.getElementById("gs-frequency-dialog-styles"))return;const e=document.createElement("style");e.id="gs-frequency-dialog-styles",e.textContent=he,document.head.appendChild(e)}handleOutsideClick(e){this.element.classList.contains(oe)&&!this.element.contains(e.target)&&this.hide()}handleKeyDown(e){"Escape"===e.key&&this.element.classList.contains(oe)&&this.hide()}renderTable(e){this.tableBody.innerHTML="",e.forEach((([e,t,n])=>{const o=document.createElement("tr"),i=document.createElement("td");i.textContent=e;const s=document.createElement("td");s.textContent=t.toString();const r=document.createElement("td");r.textContent=`${n.toFixed(1)}%`,o.appendChild(i),o.appendChild(s),o.appendChild(r),this.tableBody.appendChild(o)}))}show(e,t,n={}){if(n.columnName){const e=this.element.querySelector(`.${se}`);e&&(e.textContent=`Frequency: ${n.columnName}`)}this.renderTable(e),this.positionDialog(t),this.element.classList.add(oe),document.addEventListener("click",this.handleOutsideClickBound),document.addEventListener("keydown",this.handleKeyDownBound),this.closeButton.focus()}hide(){this.element.classList.remove(oe),document.removeEventListener("click",this.handleOutsideClickBound),document.removeEventListener("keydown",this.handleKeyDownBound),this.onCloseCallback&&this.onCloseCallback()}positionDialog(e){const t=e.getBoundingClientRect(),n=this.element.getBoundingClientRect(),o=window.innerWidth,i=window.innerHeight,s=window.scrollX||document.documentElement.scrollLeft,r=window.scrollY||document.documentElement.scrollTop;let l=t.bottom+r+5,a=t.right+s-n.width;a+n.width>o+s&&(a=o+s-n.width-10),a<s&&(a=s+10),l+n.height>i+r&&(l=t.top-n.height>r?t.top+r-n.height-5:i+r-n.height-10),this.element.style.top=`${Math.max(r+10,l)}px`,this.element.style.left=`${a}px`}onClose(e){this.onCloseCallback=e}destroy(){document.removeEventListener("click",this.handleOutsideClickBound),document.removeEventListener("keydown",this.handleKeyDownBound),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}const me=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],pe="gs-frequency-chart-dialog",ge="gs-frequency-chart-dialog--visible",fe="gs-frequency-chart-dialog__header",be="gs-frequency-chart-dialog__title",ye="gs-frequency-chart-dialog__close",we="gs-frequency-chart-dialog__content",ve="gs-frequency-chart-dialog__chart",xe="gs-frequency-chart-dialog__svg-chart",Ce="gs-frequency-chart-dialog__svg-axis",Ee="gs-frequency-chart-dialog__svg-bar",ke="gs-frequency-chart-dialog__svg-label",_e=`\n.${pe} {\n  position: absolute;\n  background: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  z-index: 10000;\n  min-width: 300px;\n  max-width: 600px;\n  max-height: 60vh;\n  display: flex;\n  flex-direction: column;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  font-size: 13px;\n  line-height: 1.4;\n  opacity: 0;\n  transform: translateY(-10px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n  pointer-events: none;\n}\n\n.${ge} {\n  opacity: 1;\n  transform: translateY(0);\n  pointer-events: auto;\n}\n\n.${fe} {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px 12px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.${be} {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: #333;\n}\n\n.${ye} {\n  background: none;\n  border: none;\n  font-size: 16px;\n  cursor: pointer;\n  color: #999;\n  padding: 2px 6px;\n  border-radius: 3px;\n  line-height: 1;\n}\n\n.${ye}:hover {\n  background: #f5f5f5;\n  color: #666;\n}\n\n.${we} {\n  padding: 12px;\n  overflow-y: auto;\n}\n\n.${ve} {\n  width: 100%;\n  font-family: monospace;\n}\n\n.${xe} {\n  width: 100%;\n  height: 300px;\n  margin-top: 10px;\n}\n\n.${Ce} {\n  stroke: #999;\n  stroke-width: 1px;\n}\n\n.${Ee} {\n  transition: fill 0.2s ease;\n}\n\n.${Ee}:hover {\n  opacity: 0.8;\n}\n\n.${ke} {\n  font-size: 10px;\n  fill: #666;\n}\n\n/* Scrollbar styling */\n.${we}::-webkit-scrollbar {\n  width: 6px;\n  height: 6px;\n}\n\n.${we}::-webkit-scrollbar-thumb {\n  background-color: #c1c1c1;\n  border-radius: 3px;\n}\n\n.${we}::-webkit-scrollbar-thumb:hover {\n  background-color: #a8a8a8;\n}\n\n.${we}::-webkit-scrollbar-track {\n  background-color: #f1f1f1;\n  border-radius: 3px;\n}\n`;class Se{constructor(){__publicField(this,"element"),__publicField(this,"contentElement"),__publicField(this,"chartElement"),__publicField(this,"closeButton"),__publicField(this,"onCloseCallback",null),__publicField(this,"handleOutsideClickBound"),__publicField(this,"handleKeyDownBound"),this.injectStyles(),this.element=document.createElement("div"),this.element.className=pe,this.element.setAttribute("role","dialog"),this.element.setAttribute("aria-labelledby","gs-frequency-chart-dialog-title");const e=document.createElement("div");e.className=fe;const t=document.createElement("h3");t.className=be,t.id="gs-frequency-chart-dialog-title",t.textContent="Frequency Chart",this.closeButton=document.createElement("button"),this.closeButton.className=ye,this.closeButton.innerHTML="&times;",this.closeButton.setAttribute("aria-label","Close"),this.closeButton.addEventListener("click",(()=>this.hide())),e.appendChild(t),e.appendChild(this.closeButton),this.contentElement=document.createElement("div"),this.contentElement.className=we,this.chartElement=document.createElement("div"),this.chartElement.className=ve,this.contentElement.appendChild(this.chartElement),this.element.appendChild(e),this.element.appendChild(this.contentElement),document.body.appendChild(this.element),this.handleOutsideClickBound=this.handleOutsideClick.bind(this),this.handleKeyDownBound=this.handleKeyDown.bind(this)}injectStyles(){if(document.getElementById("gs-frequency-chart-dialog-styles"))return;const e=document.createElement("style");e.id="gs-frequency-chart-dialog-styles",e.textContent=_e,document.head.appendChild(e)}handleOutsideClick(e){this.element.classList.contains(ge)&&!this.element.contains(e.target)&&this.hide()}handleKeyDown(e){"Escape"===e.key&&this.element.classList.contains(ge)&&this.hide()}renderChart(e){if(this.chartElement.innerHTML="",0===e.length){const e=document.createElement("div");return e.textContent="No data available",e.style.padding="10px",e.style.color="#666",void this.chartElement.appendChild(e)}const t=20,n=30,o=60,i=60,s=500-i-n,r=300-t-o,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width",(s+i+n).toString()),l.setAttribute("height",(r+t+o).toString()),l.setAttribute("class",xe),l.setAttribute("role","img"),l.setAttribute("aria-label","Frequency bar chart");const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("transform",`translate(${i},${t})`);const c=Math.max(...e.map((([e,t])=>t))),d=Math.max(10,Math.min(60,s/e.length-10)),h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1","0"),h.setAttribute("y1","0"),h.setAttribute("x2","0"),h.setAttribute("y2",r.toString()),h.setAttribute("class",Ce);const u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1","0"),u.setAttribute("y1",r.toString()),u.setAttribute("x2",s.toString()),u.setAttribute("y2",r.toString()),u.setAttribute("class",Ce),a.appendChild(h),a.appendChild(u);for(let g=0;g<=5;g++){const e=Math.round(c*(g/5)),t=r-r*(g/5),n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","-5"),n.setAttribute("y1",t.toString()),n.setAttribute("x2","0"),n.setAttribute("y2",t.toString()),n.setAttribute("class",Ce);const o=document.createElementNS("http://www.w3.org/2000/svg","text");if(o.setAttribute("x","-10"),o.setAttribute("y",t.toString()),o.setAttribute("text-anchor","end"),o.setAttribute("alignment-baseline","middle"),o.setAttribute("class",ke),o.textContent=e.toString(),a.appendChild(n),a.appendChild(o),g>0){const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","0"),e.setAttribute("y1",t.toString()),e.setAttribute("x2",s.toString()),e.setAttribute("y2",t.toString()),e.setAttribute("stroke","#eee"),e.setAttribute("stroke-dasharray","2,2"),a.appendChild(e)}}const m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("transform",`translate(-40,${r/2}) rotate(-90)`),m.setAttribute("text-anchor","middle"),m.setAttribute("class",ke),m.textContent="Count",a.appendChild(m);const p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("transform",`translate(${s/2},${r+45})`),p.setAttribute("text-anchor","middle"),p.setAttribute("class",ke),p.textContent="Values",a.appendChild(p),e.forEach((([t,n,o],i)=>{const l=n/c*r,h=s/e.length*i+(s/e.length-d)/2,u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttribute("x",h.toString()),u.setAttribute("y",(r-l).toString()),u.setAttribute("width",d.toString()),u.setAttribute("height",l.toString()),u.setAttribute("class",Ee);const m=i%me.length;u.setAttribute("fill",me[m]),u.setAttribute("data-value",t),u.setAttribute("data-count",n.toString()),u.setAttribute("data-percentage",o.toFixed(1)),u.addEventListener("mouseover",(e=>{const i=e.target,s=document.createElementNS("http://www.w3.org/2000/svg","title");s.textContent=`${t}: ${n} (${o.toFixed(1)}%)`,i.appendChild(s)})),a.appendChild(u);const p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x",(h+d/2).toString()),p.setAttribute("y",(r+15).toString()),p.setAttribute("text-anchor","middle"),p.setAttribute("class",ke);const g=t.length>10?t.substring(0,10)+"...":t;p.textContent=g,p.setAttribute("title",t),a.appendChild(p)})),l.appendChild(a),this.chartElement.appendChild(l)}show(e,t,n={}){if(n.columnName){const e=this.element.querySelector(`.${be}`);e&&(e.textContent=`Frequency Chart: ${n.columnName}`)}this.renderChart(e),this.positionDialog(t),this.element.classList.add(ge),document.addEventListener("click",this.handleOutsideClickBound),document.addEventListener("keydown",this.handleKeyDownBound),this.closeButton.focus()}hide(){this.element.classList.remove(ge),document.removeEventListener("click",this.handleOutsideClickBound),document.removeEventListener("keydown",this.handleKeyDownBound),this.onCloseCallback&&this.onCloseCallback()}positionDialog(e){const t=e.getBoundingClientRect(),n=this.element.getBoundingClientRect(),o=window.innerWidth,i=window.innerHeight,s=window.scrollX||document.documentElement.scrollLeft,r=window.scrollY||document.documentElement.scrollTop;let l=t.bottom+r+5,a=t.right+s-n.width;a+n.width>o+s&&(a=o+s-n.width-10),a<s&&(a=s+10),l+n.height>i+r&&(l=t.top-n.height>r?t.top+r-n.height-5:i+r-n.height-10),this.element.style.top=`${Math.max(r+10,l)}px`,this.element.style.left=`${a}px`}onClose(e){this.onCloseCallback=e}destroy(){document.removeEventListener("click",this.handleOutsideClickBound),document.removeEventListener("keydown",this.handleKeyDownBound),this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}const $e="grid-sight-toggle",Ae="grid-sight-toggle-container",Le="grid-sight-toggle--active",Ne="grid-sight-enabled",qe=document.createElement("style");qe.textContent=A,document.head.appendChild(qe);function Be(e){var t,o,i,s;const r=e,{type:l,enrichmentType:a,header:c,headerIndex:d}=r.detail;console.log(`Enrichment selected: ${a} for ${l} header at index ${d}`);const h=c.closest("table");if(h){if(window._gsStatisticsPopup||(window._gsStatisticsPopup=new te),"heatmap"===a)if("column"===l){const e=c.cellIndex;e>=0&&w(h,e,"column")}else if("row"===l){const e=Array.from((null==(o=null==(t=c.closest("tr"))?void 0:t.parentElement)?void 0:o.children)||[]).indexOf(c.closest("tr"));e>=0&&w(h,e+1,"row")}else"table"===l&&w(h,-1,"table");else if("statistics"===a){if("column"===l){const e=c.cellIndex;if(e>=0)try{const t=function(e,t){var o;const i=[],s=(null==(o=e.tBodies[0])?void 0:o.rows)||[];for(let r=0;r<s.length;r++){const e=s[r].cells[t];if(!e)continue;const o=n(e.textContent||"");null!==o&&i.push(o)}return i}(h,e),o=j(t);window._gsStatisticsPopup.show(o,c)}catch(u){console.error("Error calculating statistics:",u),alert(`Error: ${u instanceof Error?u.message:"Unknown error"}`)}}else if("row"===l){const e=c.closest("tr");if(!e)return void console.error("Could not find row");try{const t=function(e){const t=[],o=Array.from(e.cells);for(let i=o.length>0&&"th"===o[0].tagName.toLowerCase()?1:0;i<o.length;i++){const e=n(o[i].textContent||"");null!==e&&t.push(e)}return t}(e);if(0===t.length)return void alert("No numeric values found in this row");const o=j(t);window._gsStatisticsPopup.show(o,c)}catch(u){console.error("Error calculating statistics for row:",u),alert(`Error: ${u instanceof Error?u.message:"Unknown error"}`)}}else if("table"===l)try{const e=function(e){const t=[],o=Array.from(e.rows);for(let i=e.tHead?e.tHead.rows.length:1;i<o.length;i++){const e=o[i],s=Array.from(e.cells);for(let o=s.length>0&&"th"===s[0].tagName.toLowerCase()?1:0;o<s.length;o++){const e=n(s[o].textContent||"");null!==e&&t.push(e)}}return t}(h);if(0===e.length)return void alert("No numeric values found in this table");const t=j(e);window._gsStatisticsPopup.show(t,c)}catch(u){console.error("Error calculating statistics for table:",u),alert(`Error: ${u instanceof Error?u.message:"Unknown error"}`)}}else if("frequency"===a||"frequency-chart"===a)try{let e=[],t="";if("column"===l){const n=c,o=n.cellIndex;if(o<0)throw new Error("Invalid column index");e=Array.from(h.rows).filter(((e,t)=>t>0)).map((e=>{const t=e.cells[o];return t&&t.textContent||""})),t=(null==(i=n.textContent)?void 0:i.trim())||`Column ${o+1}`}else{if("row"!==l)throw new Error("Unsupported enrichment target type");{const n=c.closest("tr");if(!n)throw new Error("Could not find row");const o=n.rowIndex,i=Array.from(n.cells),r=i.length>0&&"th"===i[0].tagName.toLowerCase()?1:0;e=i.slice(r).map((e=>e.textContent||"")),t=i.length>0&&(null==(s=i[0].textContent)?void 0:s.trim())||`Row ${o+1}`}}const n=V(e);"frequency"===a?(window._gsFrequencyDialog||(window._gsFrequencyDialog=new ue),window._gsFrequencyDialog.show(n,c,{columnName:t})):"frequency-chart"===a&&(window._gsFrequencyChartDialog||(window._gsFrequencyChartDialog=new Se),window._gsFrequencyChartDialog.show(n,c,{columnName:t}))}catch(u){console.error("Error calculating frequencies:",u),alert(`Error: ${u instanceof Error?u.message:"Unknown error"}`)}if("statistics"!==a){const e=new CustomEvent(`gridsight:enrichment:${a}`,{bubbles:!0,detail:{type:l,header:c,headerIndex:d}});c.dispatchEvent(e)}}}function Me(e){var t;const n=(null==(t=e.tHead)?void 0:t.rows[0])||e.rows[0];if(!(null==n?void 0:n.cells.length))return console.warn("Could not find a suitable cell to inject the Grid-Sight toggle"),!1;const o=n.cells[0];if(o.querySelector(`.${$e}, .${Ae}`))return!1;try{const t=function(){const e=document.createElement("div");e.className=Ae;const t=document.createElement("button");return t.className=$e,t.textContent="GS",t.setAttribute("aria-label","Toggle Grid-Sight"),t.setAttribute("aria-expanded","false"),t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.style.cssText="\n    cursor: pointer;\n    border: 1px solid #ccc;\n    background: #f8f8f8;\n    border-radius: 3px;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-weight: bold;\n    color: #555;\n    margin-right: 8px;\n    vertical-align: middle;\n    transition: all 0.2s ease;\n  ",t.addEventListener("mouseenter",(()=>{t.style.background="#e8e8e8",t.style.borderColor="#999"})),t.addEventListener("mouseleave",(()=>{t.style.background="#f8f8f8",t.style.borderColor="#ccc"})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),e.appendChild(t),e}(),n=t.querySelector(`.${$e}`);return o.insertBefore(t,o.firstChild),n&&n.addEventListener("click",(t=>{t.stopPropagation();const o=n.closest(`.${Ae}`),i=n.classList.toggle(Le);null==o||o.classList.toggle(Le,i),n.setAttribute("aria-expanded",String(i));const s=new CustomEvent("gridsight:toggle",{bubbles:!0,detail:{active:i,target:t.target}});if(n.dispatchEvent(s),i){e.classList.add(Ne);const t=Array.from(e.rows).map((e=>Array.from(e.cells).map((e=>e.textContent||"")))),{columnTypes:n}=function(e,t={}){const n=r(e,t),o=n.filter((e=>"numeric"===e||"categorical"===e)).length;return{columnTypes:n,isSuitable:o>=1}}(t);!function(e,t){S(e);const n=e.rows[0];if(n){Array.from(n.cells).forEach(((e,n)=>{const o=0===n,i=t[n];"numeric"!==i&&"categorical"!==i||$(e,o?"table":"column")}));for(let t=1;t<e.rows.length;t++){const n=e.rows[t];n.cells.length&&$(n.cells[0],"row")}}}(e,n),e.addEventListener("gridsight:enrichmentSelected",Be)}else e.classList.remove(Ne),S(e),C(),e.removeEventListener("gridsight:enrichmentSelected",Be)})),e.classList.add("grid-sight-enabled"),!0}catch(i){return console.error("Failed to inject Grid-Sight toggle:",i),!1}}const Fe=new Map,Te={version:"0.1.0",init(e={}){return document.querySelectorAll("table").forEach(((t,n)=>{if(this.isValidTable(t))try{this.processTable(t,{id:`table-${n}`,...e})}catch(o){console.error(`Failed to process table ${n}:`,o)}else console.warn(`Skipping invalid table at index ${n}: Table must have at least two rows`)})),this},processTable(t,n={}){if(!t)throw new Error("No table element provided");t.id||(t.id=n.id||`grid-sight-${Math.random().toString(36).substr(2,9)}`);const o=e(t,n);Fe.set(t.id,t);try{Me(t)}catch(i){console.warn("Failed to inject UI elements:",i)}return o},isValidTable(e){if(!(e&&e instanceof HTMLTableElement))return!1;return e.rows.length>=2},getTableById:e=>Fe.get(e),getAllTables:()=>Array.from(Fe.values()),applyHeatmap(e,t,n="column",o={}){const i="string"==typeof e?this.getTableById(e):e;if(!i)throw new Error("Table not found");g(i,t,n,o)},removeHeatmap(e,t,n){if("string"==typeof e){const o=this.getTableById(e);o&&b(o,t,n)}else b(e,t,n)},toggleHeatmap(e,t,n="column",o={}){const i="string"==typeof e?this.getTableById(e):e;if(!i)throw new Error("Table not found");w(i,t,n,o)},isHeatmapActive(e,t,n="column"){const o="string"==typeof e?this.getTableById(e):e;return!!o&&m(o,t,n)},getColumnType(e,t){const n="string"==typeof e?this.getTableById(e):e;if(!n)throw new Error("Table not found");return r(l(n))[t]||"unknown"},getTableStructure(e){var t;const n="string"==typeof e?this.getTableById(e):e;if(!n)throw new Error("Table not found");const o=l(n);return{rows:o.length,cols:(null==(t=o[0])?void 0:t.length)||0,hasHeader:this.detectIfTableHasHeader(n)}},detectIfTableHasHeader(e){if(e.rows.length<2)return!1;const t=e.rows[0],n=e.rows[1],o=Array.from(t.cells).filter((e=>e.textContent&&""!==e.textContent.trim())).length;if(0===o)return!1;return o>=Array.from(n.cells).filter((e=>e.textContent&&""!==e.textContent.trim())).length}};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{Te.init()})):setTimeout((()=>Te.init()),0),"undefined"!=typeof window&&(window.gridSight=Te),"undefined"!=typeof globalThis&&(globalThis.gridSight=Te),"undefined"!=typeof module&&module.exports&&(module.exports=Te),Te}();
//# sourceMappingURL=grid-sight.iife.js.map
