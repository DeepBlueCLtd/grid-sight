(function(d,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(d=typeof globalThis<"u"?globalThis:d||self,a(d.GridSight={}))})(this,function(d){"use strict";const a={TOGGLE_ACTIVATED:"grid-sight:toggle-activated",TOGGLE_DEACTIVATED:"grid-sight:toggle-deactivated",ENRICHMENT_APPLIED:"grid-sight:enrichment-applied",ENRICHMENT_REMOVED:"grid-sight:enrichment-removed"},g=()=>{document.addEventListener(a.TOGGLE_ACTIVATED,e=>{const o=e.detail.tableElement;o.classList.add("grid-sight-active"),console.log("Grid-Sight activated for table:",o)}),document.addEventListener(a.TOGGLE_DEACTIVATED,e=>{const o=e.detail.tableElement;o.classList.remove("grid-sight-active"),console.log("Grid-Sight deactivated for table:",o)})},u=(e,t)=>{const o=new CustomEvent(e,{bubbles:!0,detail:t});document.dispatchEvent(o)},v=e=>{const t=[];if(e.forEach(n=>{var c;const r=parseFloat(((c=n.textContent)==null?void 0:c.trim())||"");isNaN(r)?n.style.backgroundColor="transparent":t.push({cell:n,value:r})}),t.length===0)return;const o=t.map(n=>n.value),s=Math.min(...o),i=Math.max(...o);t.forEach(({cell:n,value:r})=>{const c=(r-s)/(i-s),l=A(c);n.style.backgroundColor=l})},A=e=>{const t=Math.round(e*255),o=Math.round((1-e)*255);return`rgb(${t}, 0, ${o})`},T=e=>{e.forEach(t=>{t.style.backgroundColor=""})},C=e=>{const t=e.reduce((n,r)=>n+r,0)/e.length,s=e.map(n=>Math.pow(n-t,2)).reduce((n,r)=>n+r,0)/e.length,i=Math.sqrt(s);return e.map(n=>(n-t)/(i||1))},x=(e,t=2)=>{const o=[];if(e.forEach(r=>{var l;const c=parseFloat(((l=r.textContent)==null?void 0:l.trim())||"");isNaN(c)||o.push({cell:r,value:c})}),o.length===0)return[];const s=o.map(r=>r.value),i=C(s);return o.map((r,c)=>({cell:r.cell,value:r.value,zScore:i[c]})).filter(r=>Math.abs(r.zScore)>t)},S=e=>{e.forEach(({cell:t,zScore:o})=>{t.classList.add("grid-sight-outlier"),t.setAttribute("data-zscore",o.toFixed(2));const s=o>0;t.style.border=`2px solid ${s?"red":"blue"}`,t.style.position="relative",t.title=`Z-Score: ${o.toFixed(2)}`})},L=e=>{e.forEach(t=>{t.classList.remove("grid-sight-outlier"),t.removeAttribute("data-zscore"),t.style.border="",t.title=""})},E=(e,t,o)=>{e.preventDefault(),e.stopPropagation(),p();const s=document.createElement("div");s.className="grid-sight-context-menu",[{label:"Apply Heatmap",action:()=>w(t,o,e.target)},{label:"Detect Outliers",action:()=>D(t,o,e.target)},{label:"Clear Enrichments",action:()=>I(t,o,e.target)}].forEach(n=>{const r=document.createElement("div");r.className="grid-sight-context-menu-item",r.textContent=n.label,r.addEventListener("click",()=>{n.action(),p()}),s.appendChild(r)}),s.style.position="absolute",s.style.left=`${e.pageX}px`,s.style.top=`${e.pageY}px`,document.body.appendChild(s),document.addEventListener("click",p,{once:!0})},p=()=>{const e=document.querySelector(".grid-sight-context-menu");e&&e.remove()},w=(e,t,o)=>{const s=f(e,t,o);s.length>0&&(v(s),u(a.ENRICHMENT_APPLIED,{tableElement:e,enrichmentType:"heatmap",cells:s}))},D=(e,t,o)=>{const s=f(e,t,o);if(s.length>0){const i=x(s);S(i),u(a.ENRICHMENT_APPLIED,{tableElement:e,enrichmentType:"zscore",cells:s,outliers:i})}},I=(e,t,o)=>{const s=f(e,t,o);s.length>0&&(T(s),L(s),u(a.ENRICHMENT_REMOVED,{tableElement:e,cells:s}))},f=(e,t,o)=>{const s=[];if(t){const i=e.querySelector("thead tr");if(!i)return s;const n=Array.from(i.querySelectorAll("th"));let r=-1;if(n.forEach((l,h)=>{l.contains(o)&&(r=h)}),r===-1)return s;e.querySelectorAll("tbody tr").forEach(l=>{const h=l.querySelectorAll("td")[r];h&&s.push(h)})}else{const i=Array.from(e.querySelectorAll("tbody tr"));let n=null;for(const c of i)if(c.contains(o)){n=c;break}if(!n)return s;const r=Array.from(n.querySelectorAll("td"));r[0]&&r[0].contains(o)?s.push(...r.slice(1)):s.push(...r)}return s},N=e=>{const t=document.createElement("div");t.className="grid-sight-toggle",t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.setAttribute("aria-label","Toggle Grid-Sight data visualization");let o=!1;y(t,o),k(t,e),t.addEventListener("click",()=>{o=!o,y(t,o),o?(u(a.TOGGLE_ACTIVATED,{tableElement:e}),M(e)):(u(a.TOGGLE_DEACTIVATED,{tableElement:e}),G(e))}),t.addEventListener("keydown",s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t.click())}),document.body.appendChild(t)},y=(e,t)=>{t?(e.classList.add("active"),e.setAttribute("aria-pressed","true"),e.textContent="GS"):(e.classList.remove("active"),e.setAttribute("aria-pressed","false"),e.textContent="GS")},k=(e,t)=>{const o=t.getBoundingClientRect();e.style.position="absolute",e.style.top=`${o.top+window.scrollY}px`,e.style.left=`${o.right+window.scrollX-40}px`,e.style.backgroundColor="#2c3e50",e.style.color="white",e.style.padding="4px 8px",e.style.borderRadius="4px",e.style.cursor="pointer",e.style.zIndex="1000",e.style.fontSize="14px",e.style.fontWeight="bold"},M=e=>{e.querySelectorAll("thead th").forEach(s=>{const i=document.createElement("span");i.className="grid-sight-plus-icon",i.textContent="+",i.style.marginLeft="5px",i.style.cursor="pointer",i.addEventListener("click",n=>{E(n,e,!0)}),i.setAttribute("tabindex","0"),i.setAttribute("role","button"),i.setAttribute("aria-label","Show column options"),i.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),i.click())}),s.appendChild(i)}),e.querySelectorAll("tbody tr").forEach(s=>{const i=s.querySelector("td");if(i){const n=document.createElement("span");n.className="grid-sight-plus-icon",n.textContent="+",n.style.marginRight="5px",n.style.cursor="pointer",n.addEventListener("click",r=>{E(r,e,!1)}),n.setAttribute("tabindex","0"),n.setAttribute("role","button"),n.setAttribute("aria-label","Show row options"),n.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),n.click())}),i.insertBefore(n,i.firstChild)}})},G=e=>{e.querySelectorAll(".grid-sight-plus-icon").forEach(o=>{o.remove()})},q=e=>{const t=!!e.querySelector("thead"),o=!!e.querySelector("tbody");return!t||!o?(console.error("Grid-Sight: invalid table structure - missing thead or tbody"),!1):!0},m=e=>{q(e)&&N(e)},O=()=>{document.querySelectorAll("table").forEach(t=>{m(t)}),R()},R=()=>{new MutationObserver(t=>{t.forEach(o=>{o.addedNodes.forEach(s=>{s.nodeName==="TABLE"&&m(s),s.nodeType===Node.ELEMENT_NODE&&s.querySelectorAll("table").forEach(n=>{m(n)})})})}).observe(document.body,{childList:!0,subtree:!0})},V="0.1.0";function b(){console.log(`Grid-Sight v${V} initialized`),g(),O()}typeof window<"u"&&window.addEventListener("DOMContentLoaded",()=>{b()}),d.initialize=b,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=grid-sight.umd.js.map
